window._walkmeWebpackJP&&_walkmeWebpackJP([3],{69:function(t,e,a){(function(t){"use strict";var a=function(){function t(t,e,a){this._dataManagerWasInit=!1,this._siteConfigManager=t,this._clientOrServerStorageManager=e,this._commonUtils=a,this.AG_DATA_COOKIE_NAME=e.keysConfig.attentionGrabber.data.key}return t.prototype.updateSelection=function(t){this.selectedId=t,this.save()},t.prototype.updateEvent=function(){this._eventTimestamp=(new Date).getTime(),this.save()},t.prototype.updateUnload=function(){this.unload=1,this.save()},t.prototype.init=function(){var t=this._clientOrServerStorageManager.getData(this.AG_DATA_COOKIE_NAME),e=(new Date).getTime(),a=this._siteConfigManager.get().Settings,i=parseInt(a.AGDataVersion)||0;if(t){this._sessionTimestamp=e,this.sessionCounter=t.sc||1,this._version=this._commonUtils.isDefined(t.v)?t.v:i,this._shouldUpdateVersion=i>this._version;var s,n=t.st?Math.abs(e-t.st):0;this._commonUtils.isLocalStorageEnabled()&&(s=window.localStorage.getItem(this._clientOrServerStorageManager.keysConfig.attentionGrabber.sessionLength.key)),this._sessionLength=parseFloat(s||a.AGSL||1440),this._shouldUpdateCounter=n/6e4>this._sessionLength,this.isNewSession=this._shouldUpdateCounter||this._shouldUpdateVersion,this.sessionCounter=this._shouldUpdateVersion?1:this._shouldUpdateCounter?this.sessionCounter+1:this.sessionCounter,this._version=this._shouldUpdateVersion?i:t.v,this.selectedId=this.isNewSession?void 0:t.id,this._eventTimestamp=this.isNewSession?e:t.et,this.unload=this.isNewSession?0:t.u,this.eventTimestampDelta=this._eventTimestamp?Math.abs(e-this._eventTimestamp):0}else this.isNewSession=!0,this._sessionTimestamp=e,this.sessionCounter=1,this._version=i,this._eventTimestamp=e,this.unload=0;this._dataManagerWasInit=!0,this.save()},t.prototype.save=function(){if(!this._dataManagerWasInit)return;var t={st:this._sessionTimestamp,sc:this.sessionCounter,v:this._version,id:this.selectedId,et:this._eventTimestamp,u:this.unload};this._clientOrServerStorageManager.saveData(this.AG_DATA_COOKIE_NAME,t,this._clientOrServerStorageManager.keysConfig.attentionGrabber.data.expiry)},t}();e.AttentionGrabberDataManager=a,t.register("AttentionGrabberDataManager").asCtor(a).dependencies("SiteConfigManager, ClientOrServerStorageManager, CommonUtils")}).call(e,a(2))},70:function(t,e,a){(function(t){"use strict";var i=function(){function e(t,e,a,i,s,n,r,o){this.commonUtils=n,this.NEW_CONTENT_PRIORITY=1e3,this._conditionTreeEvaluator=t,this._clientOrServerStorageManager=a,this._publishDataManager=i,this._logger=s,this._agDataManager=e}return e.prototype.init=function(t){if(!t.config||!t.player)return;this._config=t.config,this._player=t.player,this._menu=t.menu;var e=this._config.Settings.AG,a=this._config.Settings.AGs;if(a&&a.length>0)this._agDataManager.init(),this.initAllAGs(a);else if(e){var i=this.create(t);i.setupAttenGrab()}},e.prototype.reset=function(){this._agData=this._agClass=this._config=this._player=this._menu=void 0},e.prototype.initAllAGs=function(t){if(this._agDataManager.isNewSession){1===this._agDataManager.sessionCounter&&this._publishDataManager.saveDataVersion();var e=this.getPotentialAGsForNewSession(t);e=e.sort(function(t,e){return t.Priority-e.Priority}),this.updateAGForNewSession(e)}else this.updateAGForOldSession(t);this._agData?(this._logger.customerLog("Attention grabber - name: "+this._agData.Name+", settings:",3),this._logger.customerLog(this._agData.Settings,3)):this._logger.customerLog("Attention grabber: not selected",3);var a="Attention grabber data: session counter = "+this._agDataManager.sessionCounter+", selected AG = "+this._agDataManager.selectedId+", unload AG = "+this._agDataManager.unload+", event timestamp delta = "+this._agDataManager.eventTimestampDelta/1e3+"s, session = "+this._agDataManager.isNewSession;this._logger.customerLog(a,4)},e.prototype.getPotentialAGsForNewSession=function(t){for(var e=[],a=this._agDataManager.sessionCounter,i=0;i<t.length;i++){var s=t[i],n=s.Settings;this.shouldPlayAtSession(a,n)&&(parseInt(n.newContent)?this._publishDataManager.hasNewDeployables()&&(s.Priority-=this.NEW_CONTENT_PRIORITY,e.push(s)):e.push(s))}return e},e.prototype.updateAGForNewSession=function(t){for(var e=0;e<t.length;e++){var a=t[e],i=a.Settings;if(!i.conditions)return this._agData=a,void this._agDataManager.updateSelection(a.Id);var s=this._conditionTreeEvaluator.evaluate(i.conditions);if(s)return this._agData=a,void this._agDataManager.updateSelection(a.Id)}},e.prototype.updateAGForOldSession=function(t){for(var e=this._agDataManager.sessionCounter,a=0;a<t.length;a++){var i=t[a],s=i.Settings;if(i.Id==this._agDataManager.selectedId){var s=i.Settings;if(this.shouldPlayAtSession(e,s)&&this.shouldReplayAG(s))if(s.conditions){var n=this._conditionTreeEvaluator.evaluate(s.conditions);n?(this._agData=i,this._agDataManager.updateSelection(i.Id)):this._logger.customerLog("Attention grabber conditions are not satisfied",5)}else this._agData=i,this._agDataManager.updateSelection(i.Id);return}}},e.prototype.shouldPlayAtSession=function(t,e){if(!e||!this.commonUtils.isDefined(e.session)||!this.commonUtils.isDefined(e.interval))return!1;if(t<e.session)return!1;if(t==e.session)return!0;if(0==e.interval)return!1;if((t-e.session)%e.interval==0)return!0;return!1},e.prototype.shouldReplayAG=function(t){if(this._agDataManager.unload)return!1;if(!t)return!1;var e=this._agDataManager.eventTimestampDelta,a=parseInt(t.replay);if(!a||!e)return!1;var i=60*a*1e3;return e>i?t.delay=0:t.delay=(i-e)/1e3,!0},e.prototype.load=function(){var t=this;if(!this._agData)return;var e={config:this._config,player:this._player,menu:this._menu,agData:this._agData};a.e(2,function(a){(function(i){var s=[a(71)];(function(){t._agClass=i.create("AttentionGrabber",e),t._agClass.setupAttenGrab()}).apply(null,s)}).call(this,a(2))})},e.prototype.remove=function(t){if(!this._agClass)return void(t&&t());this._agDataManager.updateUnload(),this._agClass.remove(t)},e.prototype.create=function(e){return this._config=e.config,this._player=e.player,this._agClass=t.create("AttentionGrabber",e),this._agClass},e.prototype.getImageAG=function(e){return this._config=e.config,this._player=e.player,this._agClass=t.create("ImageAttentionGrabber",e),this._agClass},e}();e.AttentionGrabberManager=i,t.register("AttentionGrabberManager").asCtor(i).dependencies("ConditionTreeEvaluator, AttentionGrabberDataManager, ClientOrServerStorageManager, PublishDataManager, Logger, CommonUtils, SiteConfigManager, Consts")}).call(e,a(2))}});